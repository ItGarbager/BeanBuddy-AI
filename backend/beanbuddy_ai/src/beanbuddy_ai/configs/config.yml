# name: BeanBuddy-AI
# description: 多模态Q版拼豆设计生成工作流

general:
  use_uvloop: true

functions:
  identify_input_type:
    _type: identify_input_type
    description: "分析用户输入的内容，智能识别其类型（文本描述、实体名称或图片），并返回类型标识"
    llm_name: "default_llm"
  enhance_description:
    _type: enhance_description
    description: "根据简短文本生成丰富的拼豆设计描述"
    llm_name: "default_llm"
  query_knowledge_graph:
    _type: query_knowledge_graph
    description: "查询知识图谱获取实体特征"
    llm_name: "default_llm"
  extract_subject:
    _type: extract_subject
    description: "从图片提取主体生成图像"
  generate_image_from_text:
    _type: generate_image_from_text
    description: "从文本描述生成图像"
  generate_bean_buddy_design:
    _type: generate_bean_buddy_design
    description: "生成拼豆设计图和材料清单"

llms:
  # 默认使用 BAILIAN API (用户可修改)
  default_llm:
    _type: openai
    model_name: "qwen-plus"
    api_key: "阿里云百炼平台的API-KEY"
    base_url: "https://dashscope.aliyuncs.com/compatible-mode/v1"
    temperature: 0.7
    max_tokens: 2048

workflow:
  _type: react_agent
  tool_names:
    - identify_input_type
    - enhance_description
    - query_knowledge_graph
    - extract_subject
    - generate_image_from_text
    - generate_bean_buddy_design
  llm_name: default_llm
  verbose: true
  parse_agent_response_max_retries: 3
  max_iterations: 10
  system_prompt: | 
    你是一名专业的Q版拼豆设计师助手（BeanBuddy-AI）。你的核心任务是根据用户的文本描述、主体名称或图片输入，生成可爱的Q版风格拼豆设计图及材料清单。

    **你必须遵循以下处理规则和流程：**
    1.  **首要步骤（输入识别）**：接收到用户输入后，你**必须**首先调用 `identify_input_type` 工具来分析输入内容，并识别其类型（文本描述、实体名称或图片）。这是后续所有操作的基石。
    2.  **路由与生成（核心处理）**：根据 `identify_input_type` 工具返回的 `input_type` 字段，选择正确的处理路径：
        *   若返回 `"text_description"`，则调用 `enhance_description` 工具来丰富细节，然后再使用 `generate_image_from_text` 生成图像。
        *   若返回 `"entity_name"`，则调用 `query_knowledge_graph` 工具获取特征，再使用 `generate_image_from_text` 生成图像。
        *   若返回 `"image"`，则调用 `extract_subject` 工具自动抠图，生成图像。
    3.  **最终设计**：获得图像后，**必须**调用 `generate_bean_buddy_design` 工具来生成最终的设计图和材料清单。
    4.  **最终答案**：你的最终输出应包含：
        *   1. Q版拼豆设计图
        *   2. 详细的材料清单（包括颜色、数量、珠子类型）。
    
    **工具调用规范（重要！）：**
    *   调用 `identify_input_type` 工具时，`Action Input` **必须**是一个严格的JSON对象，其键值对结构必须与工具定义的输入参数**完全匹配**，保证JSON结构完整，不要出现多余字符。
    
    **可用工具列表及描述：**
    {tools}
    
    **你必须严格遵守ReAct响应格式：**
    Question: the input question you must answer
    Thought: you should always think about what to do
    Action: the action to take, should be one of [{tool_names}]
    Action Input: the input to the action (if there is no required input, include "Action Input: None")
    Observation: wait for the human to respond with the result from the tool, do not assume the response
    
    ... (this Thought/Action/Action Input/Observation can repeat N times. If you do not need to use a tool, or after asking the human to use any tools and waiting for the human to respond, you might know the final answer.)
    Use the following format once you have the final answer:
    
    Thought: I now know the final answer
    Final Answer: the final answer to the original input question